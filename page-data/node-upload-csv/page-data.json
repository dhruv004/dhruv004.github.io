{"componentChunkName":"component---src-templates-blog-post-index-tsx","path":"/node-upload-csv/","result":{"data":{"markdownRemark":{"html":"<p>This blog makes uses a script file to upload a csv file data from a node expressjs application.</p>\n<p>Start by creating a node app with express. This is what our index.js file would look like.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token string\">\"use strict\"</span>\n\n<span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"express\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Example app listening on port 3000!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>We will use the <a href=\"http://c2fo.github.io/fast-csv\">fast-csv</a> library</p>\n<blockquote>\n<p><code class=\"language-text\">npm install fast-csv –-save</code></p>\n</blockquote>\n<p>After this let us add a new route to our index.js file.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">//other requires</span>\n<span class=\"token keyword\">const</span> csv <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fast-csv\"</span><span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/readCSV\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> csvData <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">var</span> <span class=\"token constant\">CSV_STRING</span> <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>body\n    csv<span class=\"token punctuation\">.</span><span class=\"token function\">fromString</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CSV_STRING</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        headers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"count\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"value\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        ignoreEmpty<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"data\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            csvData<span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> data\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"end\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>csvData<span class=\"token punctuation\">)</span>\n            <span class=\"token comment\">//make call to database</span>\n            res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Done\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>To get csv data in req.body we will use the <a href=\"https://github.com/expressjs/body-parser\">body-parser</a> package</p>\n<blockquote>\n<p><code class=\"language-text\">npm install body-parser –save</code></p>\n</blockquote>\n<p>Now to use body parser add the text body parser.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"express\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> bodyParser <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"body-parser\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> csv <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fast-csv\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>bodyParser<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Now to make the import faster lets create a script that will post the csv file to the server. Create a file name importCSV.sh. This is how the shell script will look like.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/30351a53a46045e7d98e14b817a5d330/7527b/script.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAs0lEQVQY022O2w6CMBBE+Q3u9MayhSJaFP3/Dxu3VRMfeDg5SZuZnWJeGY4txtlBG41hUBiUglIf/1BftNandF2H4zhQhBDgpMg7K1bZfjRgZ3DhMTuQg9EKbdueksrKskSMEQURgZnxetwRmOD0AJIDRtaQNZkxLe/7HGybBo1Q13V2euvlr6oq7PuOIs0lmhCvG563Ddd1QVwYcZ6wJwtktYS6HDZGjkwE7z2stXnhf+EbRSxxppKY3QUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/30351a53a46045e7d98e14b817a5d330/fcda8/script.png\"\n        srcset=\"/static/30351a53a46045e7d98e14b817a5d330/12f09/script.png 148w,\n/static/30351a53a46045e7d98e14b817a5d330/e4a3f/script.png 295w,\n/static/30351a53a46045e7d98e14b817a5d330/fcda8/script.png 590w,\n/static/30351a53a46045e7d98e14b817a5d330/7527b/script.png 754w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Now since the script and the csv file belong in the same directory, I did not have to alter path. But you can provide your own path to the csv file in the –data-binary property.\nTo run this</p>\n<ul>\n<li>Start the server with node index.js</li>\n<li>Open the git bash terminal and run importCSV.sh\nThis is how the request and response will look like</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/787a26c5b94fe44ac75e63559193c683/17a7a/terminal-command.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.513513513513512%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjUlEQVQI112N4Q6DIAyEKYGBgkMkGozGjfd/yBtt4rLsx6Xtd71Wva4Lx3EgpYR5zohxQggBIUYMwyA8LwtyznhOE7z3GMcR1lrxlFKSYSazNQYP5+SIc17EYQ4yK6VgXVds24Z9r6h1x3me/UjsfYXp+fZustNag6L+gUiLwd9YWmupRPRlv94/v/dZH2oyQxIK9psrAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/787a26c5b94fe44ac75e63559193c683/fcda8/terminal-command.png\"\n        srcset=\"/static/787a26c5b94fe44ac75e63559193c683/12f09/terminal-command.png 148w,\n/static/787a26c5b94fe44ac75e63559193c683/e4a3f/terminal-command.png 295w,\n/static/787a26c5b94fe44ac75e63559193c683/fcda8/terminal-command.png 590w,\n/static/787a26c5b94fe44ac75e63559193c683/17a7a/terminal-command.png 753w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 563px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/20fadfcb6b281b1a21c1b886338584a0/7cb89/terminal-output.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABGElEQVQY011Pa0sCURS8+SnNxYJeH2wz8r277hKpkRZuplIEumQPdRcjoaJatZIyofrp07k3K9gPw9wzzJw5l+Ub7zDbX9ixxsgcPaNwOkG83EexOUG+MSa8wTh+gVJ9gk6s1QbI1kcwWx/Y2L/HSq6H8O4N5o0upIwDtrh9jVRliETZhVy4RfKwj2jpATotlzQbcvHup8R0EVBtxA9c4ecL+BzZo6XZHubUDvxKByykd7FOoSUSt05GKF1+YpVal2leoFCYSnL1V6i1IULGFSJTb5DK2OYZZqLnf/DFLsB89JA0hwyOMKep3Z9ui/bZVEtcEjMfxfU8FCQ9oNgiw2QLbM36Z45EZYAk/zLnqoenuhdc//V48Q0iOa7/ARzauAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/20fadfcb6b281b1a21c1b886338584a0/7cb89/terminal-output.png\"\n        srcset=\"/static/20fadfcb6b281b1a21c1b886338584a0/12f09/terminal-output.png 148w,\n/static/20fadfcb6b281b1a21c1b886338584a0/e4a3f/terminal-output.png 295w,\n/static/20fadfcb6b281b1a21c1b886338584a0/7cb89/terminal-output.png 563w\"\n        sizes=\"(max-width: 563px) 100vw, 563px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>You can find the code <a href=\"https://github.com/dhruv004/nodeUploadCsv\">here</a></p>","frontmatter":{"title":"Upload CSV file using node","subTitle":"Nodejs express app to upload a .csv file.Use of script to post the file","tags":["nodejs","express"]}}},"pageContext":{"slug":"/node-upload-csv/"}},"staticQueryHashes":["3649515864","3649515864","4202924991","4202924991"]}